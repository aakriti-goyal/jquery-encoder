<!--

    Copyright (c) 2010 - The OWASP Foundation

    The jquery-encoder is published by OWASP under the MIT license. You should read and accept the
    LICENSE before you use, modify, and/or redistribute this software.

-->
<html>
<head>
    <title>jQuery-Encoder-Plugin TestSuite</title>
    <link rel="stylesheet" href="http://github.com/jquery/qunit/raw/master/qunit/qunit.css" type="text/css" media="screen"/>
    <script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.5.min.js"></script>
    <script type="text/javascript" src="../../../libs/Class.create.js"></script>
    <script type="text/javascript" src="../../main/javascript/org/owasp/esapi/jquery/encoder.js"></script>
    <!--<script type="text/javascript" src="/Users/cschmidt/Projects/ESAPI4JS/jquery-encoder/target/jquery-encoder-2.0.js"></script>-->
    <script type="text/javascript">
        module('Canonicalize Test Suite');
        var $fn = $.canonicalize;

        test('Null Paths', function() {
            strictEqual($fn(null),      null);
            strictEqual($fn(null, true),null);
            strictEqual($fn(null, false),null);
        });

        test('Exception Paths', function() {
            equal($fn('%25', true),     '%');
            equal($fn('%25', false),    '%');
            equal($fn('%25'),           '%');
            equal($fn('%25F'),          '%F');
            equal($fn('%3c'),           '<');
            equal($fn('%3C'),           '<');
            equal($fn('%X1'),           '%X1');
            equal($fn('&lt'),           '<');
            equal($fn('&Lt'),           '<');
            equal($fn('&lT'),           '<');
            equal($fn('&LT'),           '<');
            equal($fn('&lt;'),          '<');
            equal($fn('&Lt;'),          '<');
            equal($fn('&lT;'),          '<');
            equal($fn('&LT;'),          '<');
            equal($fn('&#37;'),         '%');
            equal($fn('&#37'),          '%');
            equal($fn('&#37b'),         '%b');
            equal($fn('&#x3c'),         '<');
            equal($fn('&#x3c;'),        '<');
            equal($fn('&#x3C'),         '<');
            equal($fn('&#X3c'),         '<');
            equal($fn('&#X3C'),         '<');
            equal($fn('&#X3C;'),        '<');
        });

        test('Percent Encoding', function() {
            equal($fn('%3c'),           '<');
            equal($fn('%3C'),           '<');
        });

        test('HTML Entity Encoding', function() {
            equal($fn('&#60'),'<');
            equal($fn('&#060'),'<');
            equal($fn('&#0060'),'<');
            equal($fn('&#00060'),'<');
            equal($fn('&#000060'),'<');
            equal($fn('&#0000060'),'<');
            equal($fn('&#60;'),'<');
            equal($fn('&#060;'),'<');
            equal($fn('&#0060;'),'<');
            equal($fn('&#00060;'),'<');
            equal($fn('&#000060;'),'<');
            equal($fn('&#0000060;'),'<');
            equal($fn('&#x3c'),'<');
            equal($fn('&#x03c'),'<');
            equal($fn('&#x003c'),'<');
            equal($fn('&#x0003c'),'<');
            equal($fn('&#x00003c'),'<');
            equal($fn('&#x000003c'),'<');
            equal($fn('&#x3c;'),'<');
            equal($fn('&#x03c;'),'<');
            equal($fn('&#x003c;'),'<');
            equal($fn('&#x0003c;'),'<');
            equal($fn('&#x00003c;'),'<');
            equal($fn('&#x000003c;'),'<');
        });

        test('CSS Encoding', function() {
            equal($fn('\\3c'),'<');
            equal($fn('\\03c'),'<');
            equal($fn('\\003c'),'<');
            equal($fn('\\0003c'),'<');
            equal($fn('\\00003c'),'<');
            equal($fn('\\3C'),'<');
            equal($fn('\\03C'),'<');
            equal($fn('\\003C'),'<');
            equal($fn('\\0003C'),'<');
            equal($fn('\\00003C'),'<');
        });

        test('Detect Double Encoding', function() {
            equal($fn('&#x26;lt&#59', false), '<');
            equal($fn('%255c', false), '\\');
            equal($fn('%2525', false), '%');
            equal($fn('%26lt%3b', false), '<');
            equal($fn('&#x25;26', false), '&');
            raises($fn('%26lt; %26lt; &#x25;3c'), "Double and Multiple encoding detected");
            raises($fn('%25252525253C'), "Double Encoding detected");
        });

        module('HTML Entity Contextual Encoding');
        test('Entity Encoding', function() {
            var e = $('#test');
            e.encode('html', "<b>" );
            equal( e.html(), '&lt;b&gt;' );
            e.encode('html', "&lt;script&gt;");
            equal( e.html(), '&amp;lt;script&amp;gt;');
            equal( $.encodeForHTML('<b>'), '&lt;b&gt;')
            equal( $.encodeForHTML('&lt;script&gt;'), '&amp;lt;script&amp;gt;' );
        });

        module('HTML Attribute Contextual Encoding');
        test('Attribute Encoding', function() {
            var e = $('#test');
            equal( e.encode( 'attr', 'a', '<B>').attr('a'), '&#x3c;B&#x3e;' );
            equal( $.encodeForHTMLAttribute( '<B>' ), '&#x3c;B&#x3e;')
        });

        if ( Object.freeze ) {
            module('Testing Frozen Object');
            test('Modify encode method', function() {
               raises($.fn.encode = function(a,b) {
                   return b;
               });
            });
        }
    </script>
</head>
<body>
<div id="test" style="visibility: hidden;">test</div>
<h1 id="qunit-header">jQuery Encoder TestSuite</h1>
<h2 id="qunit-banner"></h2>
<ol id="qunit-tests" class="result"></ol>
</body>
</html>